{% include "includes/baner_post.html" %}

<div class="mb-3 container">
   <!-- Поисковая строка -->
    <div class="search-container mt-4 mb-3">
        <form id="search-form" class="search-form" data-active-rubric="{{ categories.0.id }}" 
            hx-get="{% url 'core:search' %}" 
            hx-target="#content-area" 
            hx-trigger="submit"
            onsubmit="return false;">
            <div class="input-group shadow-sm rounded overflow-hidden">
                <span class="input-group-text bg-white border-end-0">
                    <i class="bi bi-search text-primary"></i>
                </span>
                <input type="text" 
                    id="search-input"
                    name="q" 
                    class="form-control border-start-0 py-2"
                    hx-get="{% url 'core:search' %}"
                    hx-trigger="keyup changed delay:500ms"
                    hx-target="#content-area"
                    hx-include="#search-rubric-id" 
                    placeholder="Поиск..."
                    aria-label="Поиск">
                <input type="hidden" name="rubric_id" id="search-rubric-id">
                <button type="button" 
                        id="clear-search-btn"
                        class="btn bg-transparent position-absolute end-0" 
                        style="display: none; z-index: 5;"
                        onclick="clearSearchInput()">
                    <i class="bi bi-x"></i>
                </button>
                <button type="submit" class="btn btn-primary d-none">Найти</button>
            </div>
        </form>
    </div>

    <ul id='myTab' class="nav nav-pills nav-fill " id="tab-navigation">

        {% for category in categories %}
        <li class="nav-item">
            <a class="nav-link {% if forloop.first %}active{% endif %}" 
                href="#"
                data-category-id="{{ category.id }}"
                data-url="{% url 'core:post_list_by_rubric' category.id %}"
                onclick="activateTab(this, '{% url 'core:post_list_by_rubric' category.id %}')"
            >
                {{ category.name }}
            </a>
        </li>
        {% endfor %}
    </ul>


    <div id="content-area" class="mt-3">
        <div class="d-flex justify-content-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>
    
</div>


<script>
    document.getElementById('search-input').addEventListener('keyup', function() {
        const activeRubric = document.getElementById('search-form').getAttribute('data-active-rubric');
        document.getElementById('search-rubric-id').value = activeRubric;
        
        document.getElementById('clear-search-btn').style.display = 
            this.value ? 'block' : 'none';
    });
    
    document.getElementById('search-input').addEventListener('search', function() {
        const activeRubric = document.getElementById('search-form').getAttribute('data-active-rubric');
        document.getElementById('search-rubric-id').value = activeRubric;
    });
    
    function clearSearchInput() {
        document.getElementById('search-input').value = '';
        document.getElementById('clear-search-btn').style.display = 'none';
        
        const activeTab = document.querySelector('#myTab .nav-link.active');
        if (activeTab) {
            const url = activeTab.getAttribute('data-url');
            htmx.ajax('GET', url, {target: '#content-area'});
        }
    }
</script>